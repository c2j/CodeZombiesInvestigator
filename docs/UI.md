# CodeZombiesInvestigator (CZI) UI 说明文档

作为架构师和前端专家，我已更新CZI的UI说明文档，以添加更多交互细节。这包括详细的用户操作流程、键盘快捷键、鼠标交互、动画过渡、错误处理、响应式行为以及模态对话框的扩展描述。更新基于项目级组织扩展，确保UI设计更具实用性和用户友好性。文档保持原有结构，但交互说明部分已显著增强，以覆盖边缘案例和最佳实践。设计强调无障碍访问（ARIA标签）、性能优化（e.g., 防抖搜索）和无缝IPC集成。

文档适用于开发团队，实现时使用Tauri + React + Ant Design + Vis.js。所有交互均异步处理，避免UI阻塞；动画使用CSS过渡（e.g., 300ms淡入）提升流畅性。

## 1. 引言

### 1.1 项目概述
CZI是一个桌面应用，用于识别大型遗留系统中的僵尸代码。通过项目级组织（一个项目聚合多个Git仓库），用户可配置仓库、定义关联、白/黑名单，进行可达性分析，并生成报告。UI采用双核架构：Rust核心处理计算，Tauri前端负责交互。

### 1.2 设计原则
- **用户导向**：针对技术负责人、开发者、运维，提供数据驱动的清理依据。
- **交互性**：异步IPC调用，避免阻塞；支持键盘导航（e.g., Tab切换、Arrow键浏览）；添加hover、drag-and-drop、实时反馈。
- **视觉风格**：中性色调（灰/蓝），Material Icons图标；高对比度以确保可访问性；动画过渡平滑用户体验。
- **性能**：虚拟滚动表格、懒加载图表，确保无卡顿；响应式调整侧栏宽度。
- **扩展性**：项目级分组，便于多仓库管理；未来支持拖拽上传和AI辅助关联推断。

### 1.3 全局元素
- **顶部栏**：应用标题、当前项目选择下拉、帮助/设置按钮、状态指示（e.g., 上次分析时间）。交互：下拉hover展开，点击切换项目（300ms淡入动画）；状态指示实时更新（e.g., 分析进度条）。
- **侧边栏**：固定导航（项目管理、配置、报告、路径分析、设置），可折叠（点击图标 toggle，键盘Enter激活）。交互：hover高亮项，拖拽调整宽度（最小200px）。
- **模态与通知**：用于确认删除（输入Git commit消息）、进度条（分析中）、错误提示（Toast通知，自动消失5s）。交互：Esc关闭模态，Enter确认；拖拽模态位置。

## 2. 整体架构
UI分为4个主要视图，通过侧边栏切换。每个视图支持项目上下文（e.g., 过滤器默认当前项目）。数据流：用户输入配置 → IPC `run_analysis` → Rust构建图 → 前端获取报告/查询（`get_zombie_report`、`query_dependencies`） → 渲染表格/图表。删除操作触发Rust Git API。

- **技术栈**：Tauri (IPC桥接)、React (状态管理 with Redux)、Ant Design (UI组件)、Vis.js (依赖图)。
- **数据模型联动**：前端镜像Rust节点/边（e.g., NodeType::Project），JSON报告标准化输出。
- **非功能需求**：启动<2s，查询<50ms，内存<2GB；添加触屏支持（e.g., 长按模拟右键）。

## 3. 配置视图
**目的**：创建/编辑项目，分配仓库、关联规则、白/黑名单。支持JSON导入/导出。

### 3.1 线框原型图
```
+--------------------------------[顶部栏: CZI - 配置 | 当前项目: ProjectX | 新建项目 | 导入/导出]---------------------------------+
|                                                                                                                     |
| +------------------------[侧边栏: 导航]------------------------+   +------------------------[主内容: 项目配置]------------------------+ |
| | 项目管理 (展开)                                             |   | 项目树 (TreeView)                                                  | |
| |   - ProjectX (选中)                                         |   | + ProjectX                                                         | |
| |     - 仓库: RepoA (后端, URL: git@github.com/repoA)         |   |   - 仓库列表                                                       | |
| |     - 仓库: RepoB (前端, 分支: main)                        |   |     - RepoA: URL [编辑框] | 路径 [编辑框] | 分支 [下拉] | 认证 [密码框] | |
| |     - 关联: RepoA::Controller -> RepoB::API (编辑按钮)      |   |     - RepoB: ... (表格行，支持添加/删除/拖拽)                     | |
| |   - ProjectY                                                |   |   - 关联规则                                                       | |
| | 配置视图 (Active)                                           |   |     + 添加关联: 来源仓库 [下拉] -> 目标仓库 [下拉] | 类型 [下拉: CALLS/INVOKES] | |
| | 报告视图                                                    |   |     (列表: 支持编辑/删除)                                          | |
| | 路径分析视图                                                |   |                                                                    | |
| | 设置                                                        |   | 白名单 (活跃根节点)                                                | |
| +--------------------------------------------------------------+   | + 添加: [输入框 e.g., Controller方法签名] | 搜索/导入按钮          | |
|                                                                    | (Tag列表: 支持拖拽、多选删除)                                      | |
|                                                                    |                                                                    | |
|                                                                    | 黑名单 (忽略节点)                                                  | |
|                                                                    | + 添加: [输入框 e.g., 路径/符号] | 搜索按钮                       | |
|                                                                    | (Tag列表: 同上)                                                    | |
|                                                                    |                                                                    | |
|                                                                    | 操作按钮: [保存配置] [运行分析] [重置]                            | |
|                                                                    +----------------------------------------------------------------------------+
+---------------------------------------------------------------------------------------------------------------------+
```

### 3.2 组件分解
- **项目树**：Ant Design Tree，支持拖拽仓库重分配。
- **仓库表格**：Ant Design Table，可编辑列，实时验证（e.g., URL格式）。
- **关联规则列表**：自定义List组件，支持下拉选择仓库/类型。
- **白/黑名单**：Ant Design Tag + Input，支持搜索建议（基于符号ID）。
- **按钮组**：Ant Design Button，"运行分析"触发进度模态。

### 3.3 交互说明
1. **进入视图**：侧边栏点击"配置视图"（hover高亮，点击后300ms淡入主内容），默认加载当前项目；如果无项目，显示引导模态（"创建第一个项目？"，Enter确认）。
2. **新建项目**：顶部下拉hover展开列表，点击"新建"弹出模态（输入名称/描述，实时验证非空；Esc关闭，Enter提交）；提交后树刷新（动画展开新节点）。
3. **编辑仓库**：树选中节点（Arrow键导航，Enter展开/折叠；hover显示编辑图标），右侧表单加载（淡入动画）；添加行 via "+"按钮（点击或Ctrl+N），拖拽行调整顺序（实时预览虚线边界，释放后成功Toast通知）；表单输入实时防抖（500ms）验证（无效URL显示红色边框+Tooltip "无效格式"）。
4. **定义关联**：添加规则按钮点击弹出子模态（下拉选择仓库/类型，搜索过滤选项）；列表项hover显示删除/编辑图标，拖拽重排序（类似仓库）；多选（Shift+Click）批量删除（确认模态）。
5. **名单管理**：输入框focus显示建议下拉（基于历史输入），回车添加Tag（动画弹出）；Tag hover显示删除X，拖拽重排；多选（Ctrl+Click）删除（右键菜单"删除选中"）；导入JSON按钮点击文件选择器，解析失败显示错误Toast。
6. **保存/分析**：保存按钮（Ctrl+S）持久化配置（localStorage），显示成功通知；运行分析（Ctrl+R）触发全屏进度模态（百分比条+取消按钮），IPC调用后实时更新进度（每秒轮询）；取消中途停止Rust任务。
7. **键盘支持**：Tab焦点循环表单，Esc重置输入，Ctrl+Z撤销最后操作；Arrow展开树。
8. **错误处理**：网络错误（e.g., Git URL无效）弹出重试模态；过长输入截断+警告Tooltip；响应式：宽屏>1200px显示全表单，窄屏折叠为Accordion。
9. **额外细节**：鼠标长按树节点（500ms）弹出上下文菜单（重命名/删除项目）；动画：所有变化使用CSS ease-in-out；无障碍：ARIA-live公告变化（e.g., "项目已保存"）。

### 3.4 视觉参考
以下是类似配置视图的线框示例图像，用于参考实际实现。












## 4. 报告视图
**目的**：展示项目级僵尸代码报告，支持筛选、排序、人工确认删除。集成Zombies置信度（计算公式：100 - (years_since_last_modified * 20) + (if isolated: 30)）。

### 4.1 线框原型图
```
+--------------------------------[顶部栏: CZI - 报告 | 当前项目: ProjectX | 上次分析: 2025-12-09 | 僵尸数: 42]-----------------+
|                                                                                                                     |
| +------------------------[侧边栏: 导航]------------------------+   +------------------------[主内容: 报告]------------------------+   |
| | 项目管理                                                    |   | 项目过滤: [下拉: ProjectX/All] | 搜索: [符号ID/关键词]     |   |
| | 配置视图                                                    |   | 汇总卡片:                                                          |   |
| | 报告视图 (Active)                                           |   | +----------------+ +----------------+ +----------------+         |   |
| | 路径分析视图                                                |   | | 仓库数: 5      | | 僵尸占比: 20%  | | 平均置信度: 85 |         |   |
| | 设置                                                        |   | +----------------+ +----------------+ +----------------+         |   |
| +--------------------------------------------------------------+   | 筛选: [仓库] [语言] [最后修改 >] [置信度 >] [状态: 未确认/已删] |   |
|                                                                    | 主表格:                                                            |   |
|                                                                    | +------------------------------[列头: 项目 | 符号ID | 类型 | 仓库 | 最后修改 | 贡献者 | 置信度 | 状态]-----------------------------+ |
|                                                                    | | ProjectX | repoA::unused() | Func | RepoA | 2018-03-15 | John Doe | 85 | 未确认 (复选框) | |
|                                                                    | | ProjectX | repoB::oldScript | Script | RepoB | 2019-01-10 | Jane Smith | 92 | 已确认删除 | |
|                                                                    | | ... (虚拟滚动，支持展开子行显示仓库细节)                          |   |
|                                                                    | +--------------------------------------------------------------------------+ |
|                                                                    | 分页: [1/10] | 每页 [20/50/100] | 总计: 420 条                          |   |
|                                                                    | 批量操作: [确认删除 (模态: 输入commit消息)] [导出JSON/CSV] [刷新分析]    |   |
|                                                                    +------------------------[右侧侧栏: 选中节点详情 (可拖拽调整宽度)]----------+ |
|                                                                    | 符号: repoA::unused()                                              |   |
|                                                                    | 状态: DEAD_UNREACHABLE | 原因: 无活跃根连接                        |   |
|                                                                    | 元数据: 最后修改 2018-03-15 | 贡献者 John Doe | 行号 42-56       |   |
|                                                                    | 代码预览: [代码块，高亮语法]                                       |   |
|                                                                    | Git历史: [时间线列表]                                              |   |
|                                                                    | 操作: [查看路径分析] [标记删除] [编辑黑名单]                      |   |
|                                                                    +----------------------------------------------------------------------------+
+---------------------------------------------------------------------------------------------------------------------+
```

### 4.2 组件分解
- **项目过滤器**：Ant Design Select + Input。
- **汇总卡片**：Ant Design Card，KPI数字动画。
- **主表格**：Ant Design Table with react-window（虚拟滚动），支持列排序/过滤。
- **右侧侧栏**：Ant Design Drawer，可拖拽宽度；内含Code组件（代码预览）、Timeline（Git历史）。
- **批量按钮**：Ant Design Button + Modal（删除确认）。

### 4.3 交互说明
1. **加载**：IPC获取JSON报告，按项目聚合渲染（加载动画spinner）；如果数据>1000条，显示分页警告Toast。
2. **过滤/搜索**：输入框实时防抖（300ms）更新表格，hover显示清空图标；下拉选择多值（Ctrl+Click），应用后表格淡入刷新；高级筛选模态（点击"更多筛选"，支持日期范围滑块）。
3. **行交互**：点击行选中（背景高亮），双击展开子细节（仓库代码片段，动画展开）；hover行显示工具图标（预览/删除），右键弹出上下文菜单（"复制ID"/"路径分析"/"黑名单"）；多选（Shift+Click范围，Ctrl+Click单个）启用批量按钮，拖拽选中行（类似Excel）。
4. **删除确认**：批量/单个删除按钮点击弹出模态（输入commit消息，实时预览Git命令；Esc关闭，Enter提交），提交后表格实时移除行（动画淡出），成功Toast显示"已删除X项"；失败回滚+错误模态（"Git冲突，重试？"）。
5. **排序**：点击列头切换升/降序（箭头图标动画旋转），多列排序（Shift+Click）；默认置信度降序。
6. **分页**：下拉选择每页行数，点击页码跳转（平滑滚动到顶部）；无限滚动模式开关（设置中启用）。
7. **键盘**：Arrow上下行导航，Space复选/取消，Enter打开详情侧栏（Esc关闭），Ctrl+A全选，Delete键触发删除模态。
8. **侧栏交互**：拖拽边缘调整宽度（实时预览），hover元数据高亮链接（点击跳转Git历史浏览器）；代码预览支持滚动+语法高亮（Prism.js）。
9. **错误处理**：无数据显示空状态插图+提示；IPC超时重试按钮（自动重试3次）；响应式：窄屏侧栏变底栏Tab。
10. **额外细节**：汇总卡片hover显示工具提示（详细计算公式）；动画：表格刷新使用staggered fade-in；无障碍：屏幕阅读器朗读选中行（ARIA-grid）。

### 4.4 视觉参考
以下是类似报告视图的线框示例图像，用于参考仪表板布局。












## 5. 路径分析视图
**目的**：可视化项目依赖路径，突出僵尸代码链路，支持交互查询。

### 5.1 线框原型图
```
+--------------------------------[顶部栏: CZI - 路径分析 | 当前项目: ProjectX | 节点: unusedMethod()]-------------------------+
|                                                                                                                     |
| +------------------------[侧边栏: 导航]------------------------+   +------------------------[主内容: 依赖图]---------------------+ |
| | 项目管理                                                    |   | 图表区域 (Vis.js)                                                  | |
| | 配置视图                                                    |   | +------------------------------------------------------------------------+ |
| | 报告视图                                                    |   | |   [Active Root (绿圆)] --> [ServiceA (蓝矩)] --> [僵尸节点 (红圆)]    | |
| | 路径分析视图 (Active)                                       |   | |                  |                 ^                                   | |
| | 设置                                                        |   | |                  +--> [DB_Table (黄菱)] <--+ [关联边: INVOKES (箭头标签)] | |
| +--------------------------------------------------------------+   | | (支持集群: 项目边界虚线框; 高亮路径: 粗线)                       | |
|                                                                    | | 节点: 形状/颜色编码; 边: 方向箭头 + 类型标签                     | |
|                                                                    | +------------------------------------------------------------------------+ |
|                                                                    | (交互: 鼠标悬停显示Tooltip; 拖拽重定位; 捏合缩放)                   | |
|                                                                    |                                                                    | |
|                                                                    | 底部工具栏:                                                        | |
|                                                                    | + 搜索节点: [输入框] | 过滤边类型: [CALLS □] [INVOKES □] [ACCESSES □] | |
|                                                                    | + 导出: [SVG] [PNG] | [返回报告] [全屏模式]                          | |
|                                                                    +----------------------------------------------------------------------------+
+---------------------------------------------------------------------------------------------------------------------+
```

### 5.2 组件分解
- **图表区域**：Vis.js Network，支持力导向布局。
- **工具栏**：Ant Design Input + Checkbox.Group + Button。
- **Tooltip**：Vis.js内置，显示节点metadata。

### 5.3 交互说明
1. **进入**：从报告点击节点跳转（IPC查询数据，加载spinner 淡出到图）；直接进入显示默认项目全图（警告如果节点>1000："简化视图？"模态）。
2. **导航**：拖拽节点重定位（实时物理模拟），鼠标轮滚/捏合缩放（平滑过渡）；双击节点居中（动画zoom）；键盘Arrow平移图，+/-键缩放。
3. **过滤**：Checkbox点击更新边可见性，重绘图（<1s，加载遮罩）；搜索输入实时高亮匹配节点（黄色边框），Enter确认跳转到节点。
4. **节点操作**：点击节点显示持久Tooltip（拖拽移动），hover即时预览metadata（淡入）；右键弹出菜单（"查看详情"/"标记删除"/"添加黑名单"/"高亮路径"），菜单项hover子菜单（e.g., 路径选项："到根"/"到僵尸"）；长按节点（500ms）复制ID到剪贴板（Toast确认）。
5. **导出**：按钮点击下拉选择格式（SVG/PNG），生成后自动下载；全屏模式（F11或按钮）隐藏侧栏，Esc退出。
6. **键盘**：Ctrl+F focus搜索框，Esc清空过滤，Ctrl+Z撤销最后过滤；Space暂停/恢复力模拟。
7. **项目边界**：虚线框分组仓库，点击框折叠/展开子节点（动画收起）。
8. **错误处理**：无数据空状态（"无路径，重新分析？"按钮）；IPC失败重试模态（自动重连）。
9. **响应式**：宽屏全图，窄屏自动缩放适应；触屏：双指捏合缩放，长按右键菜单。
10. **额外细节**：高亮路径粗线脉冲动画（每2s）；集群模式开关（工具栏），分组节点减少 clutter；无障碍：ARIA描述图变化（e.g., "节点选中：unusedMethod"）。

### 5.4 视觉参考
以下是类似依赖图视图的线框示例图像，用于参考图形可视化。












## 6. 设置视图
**目的**：管理全局参数，如主题、认证、分析阈值。

### 6.1 线框原型图
```
+--------------------------------[顶部栏: CZI - 设置 | 当前项目: ProjectX]---------------------------------------------+
|                                                                                                                     |
| +------------------------[侧边栏: 导航]------------------------+   +------------------------[主内容: 设置表单]-----------------+ |
| | 项目管理                                                    |   | Tabs: [通用] [Git认证] [分析参数] [日志]                  | |
| | 配置视图                                                    |   |                                                                    | |
| | 报告视图                                                    |   | 通用设置:                                                          | |
| | 路径分析视图                                                |   | - 主题: [下拉: Light/Dark/System] (预览图标)                       | |
| | 设置 (Active)                                               |   | - 语言: [下拉: EN/CN]                                              | |
| +--------------------------------------------------------------+   | - 键盘快捷键: [列表: Ctrl+S 保存 等]                               | |
|                                                                    |                                                                    | |
|                                                                    | Git认证:                                                           | |
|                                                                    | - 默认Token: [密码输入框] | [测试连接按钮]                         | |
|                                                                    | - 代理设置: [输入: Host:Port]                                      | |
|                                                                    |                                                                    | |
|                                                                    | 分析参数:                                                          | |
|                                                                    | - 置信度阈值: [滑块: 0-100, 默认70] | 当前: 85                       | |
|                                                                    | - 内存上限: [下拉: 1GB/2GB/无限]                                   | |
|                                                                    | - 忽略模式: [开关: 启用黑名单优先]                                 | |
|                                                                    |                                                                    | |
|                                                                    | 日志: [查看日志按钮 -> 打开模态: 滚动文本区域]                     | |
|                                                                    |                                                                    | |
|                                                                    | 操作: [保存设置] [重置默认] [应用并重启]                           | |
|                                                                    +----------------------------------------------------------------------------+
+---------------------------------------------------------------------------------------------------------------------+
```

### 6.2 组件分解
- **Tabs**：Ant Design Tabs，分组表单。
- **表单项**：Select（下拉）、Input（文本）、Slider（滑块）、Switch（开关）。
- **日志模态**：Ant Design Modal with TextArea。

### 6.3 交互说明
1. **切换Tabs**：点击Tab（hover高亮），加载对应表单（淡入动画）；键盘Tab循环Tabs，Enter激活。
2. **修改参数**：下拉选择实时预览（e.g., 主题切换全UI）；滑块拖拽更新数值（Tooltip显示当前值），释放后保存；开关点击 toggle（动画翻转）。
3. **测试连接**：按钮点击触发IPC验证Git Token（进度spinner），成功绿色Toast，失败红色模态（"Token无效，重新输入？"）。
4. **保存**：按钮（Ctrl+S）持久化到localStorage，应用变化（e.g., 重载UI）；重置按钮弹出确认模态（"确认重置？"，Enter yes）。
5. **日志查看**：按钮点击打开模态（滚动TextArea，支持搜索高亮Ctrl+F），导出按钮下载TXT；模态拖拽调整大小，Esc关闭。
6. **键盘**：Arrow导航表单项，Enter提交下拉，Space toggle开关，Ctrl+Z撤销变更。
7. **错误处理**：无效输入（e.g., 端口非数字）实时红色边框+抖动动画；内存上限过高警告Toast。
8. **响应式**：窄屏Tabs变垂直Accordion；触屏：滑块指拖支持。
9. **额外细节**：键盘快捷键列表支持编辑（双击项弹出模态自定义）；动画：滑块值变化数字跳动；无障碍：ARIA-slider for 阈值。

### 6.4 视觉参考
以下是类似设置视图的线框示例图像，用于参考表单布局。












## 7. 附录
- **测试建议**：焦点测试IPC延迟、跨平台渲染一致性、键盘可访问性、边缘交互（e.g., 大数据加载）。
- **未来迭代**：添加实时协作（云项目共享）、AI生成关联规则。
- **文档版本**：v1.1，日期：2025-12-09（更新：添加交互细节）。
